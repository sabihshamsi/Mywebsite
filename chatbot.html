<!DOCTYPE html>
<html>
<head>
    <title>Thrift Store Chatbot</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<!-- Floating Chat Button -->
<div id="chat-button" onclick="toggleChat()">
    üí¨
</div>

<!-- Chat Window -->
<div id="chat-container">
    <div id="chat-header">
        <div id="chat-avatar"></div>
        <div id="chat-title">üíå Chat with Sabih</div>
    </div>
   <!-- In index.html -->
<div id="chat-box">
    <div class="welcome-message">
        <div class="bot-avatar"></div>
        <div class="message bot-msg">
           Hi Wajeeha ‚ù§Ô∏è it's me, Sabih. How‚Äôs my favorite person doing? ü•∞
        </div>
    </div>
</div>  

    <div id="input-area">
        <input type="text" id="user-input" placeholder="Type your message..." />
        <button onclick="sendMessage()">Send</button>
    </div>
</div>

<script>
    function toggleChat() {
        const chatContainer = document.getElementById("chat-container");
        chatContainer.style.display = (chatContainer.style.display === "none" || chatContainer.style.display === "") ? "flex" : "none";
    }

    async function sendMessage() {
        const userInput = document.getElementById("user-input");
        const message = userInput.value.trim();
        if (!message) return;

        appendMessage("You", message, true);
        userInput.value = "";

        // Show typing indicator
        const typingIndicator = document.createElement("div");
        typingIndicator.className = "typing-indicator";
        typingIndicator.innerHTML = `
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
        `;
        document.getElementById("chat-box").appendChild(typingIndicator);
        document.getElementById("chat-box").scrollTop = document.getElementById("chat-box").scrollHeight;

        try {
            const response = await fetch("/ask", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({message: message})
            });

           // Remove typing indicator
            typingIndicator.remove();

            const data = await response.json();
            if (data.reply) {
                appendMessage("Sabih", data.reply, false);
            } else {
                appendMessage("Sabih", "Sorry, there was an error.", false);
            }
        } catch (err) {
            typingIndicator.remove();
            appendMessage("Sabih", "Error connecting to server.", false);
        }
    }
function appendMessage(sender, text, isUser) {
    const chatBox = document.getElementById("chat-box");
    const messageContainer = document.createElement("div");
    messageContainer.className = isUser ? "message-container user-message-container" : "message-container bot-message-container";
    
    if (isUser) {
        messageContainer.innerHTML = `
            <div class="message user-msg">${text}</div>
            <div class="user-avatar"></div>
        `;
    } else {
        messageContainer.innerHTML = `
            <div class="bot-avatar"></div>
            <div class="message bot-msg">${text}</div>
        `;
    }
    
    chatBox.appendChild(messageContainer);
    chatBox.scrollTop = chatBox.scrollHeight;
}

    document.getElementById("user-input").addEventListener("keypress", function(e) {
        if (e.key === "Enter") {
            sendMessage();
        }
    });
    document.addEventListener('DOMContentLoaded', () => {
    // Create 30 floating hearts
    for (let i = 0; i < 30; i++) {
        const heart = document.createElement('div');
        heart.className = 'heart-particle';
        heart.innerHTML = '‚ù§Ô∏è';
        heart.style.left = `${Math.random() * 100}vw`;
        heart.style.animationDelay = `${Math.random() * 15}s`;
        heart.style.fontSize = `${Math.random() * 15 + 10}px`;
        document.body.appendChild(heart);
    }
    
});
</script>

</body>
</html>